<p style="color: green"><%= notice %></p>

<% content_for :title, "Resumes" %>

<div class="resumes-index">
  <%= link_to homepage_path, class: "back-to-home" do %>
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
      <polyline points="9 22 9 12 15 12 15 22"></polyline>
    </svg>
    <span>Home</span>
  <% end %>

  <% if admin_signed_in? %>
      <p>You are signed in with <strong><%= current_admin.email %></strong>.</p>
  <% else %>
      <p>You are not signed in.</p>
  <% end %>

  <h1>Resumes</h1>

  <!-- Filter Section -->
  <div class="filter-section">
    <%= form_with url: resumes_path, method: :get, class: "filter-form" do |f| %>
      <div class="filter-row">
        <div class="filter-group">
          <%= f.label :major, "Filter by Major:", class: "filter-label" %>
          <%= f.select :major, 
              options_for_select([["All Majors", ""]] + @majors.map { |m| [m, m] }, params[:major]),
              {}, 
              class: "filter-select" %>
        </div>

        <div class="filter-group">
          <%= f.label :organizational_role_id, "Filter by Role:", class: "filter-label" %>
          <%= f.collection_select :organizational_role_id,
              @organizational_roles,
              :id,
              :name,
              { include_blank: "All Roles" },
              class: "filter-select" %>
        </div>

        <div class="filter-group">
          <%= f.label :graduation_year, "Graduation Year:", class: "filter-label" %>
          <%= f.select :graduation_year,
              options_for_select([["All Years", ""]] + @graduation_years.map { |y| [y, y] }, params[:graduation_year]),
              {},
              class: "filter-select" %>
        </div>
      </div>

      <div class="filter-row filter-row-second">
        <div class="filter-group-gpa">
          <%= f.label :gpa_value, "Filter by GPA:", class: "filter-label" %>
          <div class="gpa-filter-controls">
            <%= f.select :gpa_operator,
                options_for_select([[">=", ">="], ["<=", "<="]], params[:gpa_operator]),
                { include_blank: "Operator" },
                class: "filter-select-small" %>
            <%= f.number_field :gpa_value,
                value: params[:gpa_value],
                placeholder: "GPA (0.0-4.0)",
                step: 0.01,
                min: 0.0,
                max: 4.0,
                class: "filter-input" %>
          </div>
        </div>

        <div class="filter-buttons">
          <%= f.submit "Apply Filters", class: "btn btn-apply-filters" %>
          <% if params[:major].present? || params[:organizational_role_id].present? || params[:graduation_year].present? || params[:gpa_value].present? %>
            <%= link_to "Clear Filters", resumes_path(request.query_parameters.except(:major, :organizational_role_id, :graduation_year, :gpa_operator, :gpa_value)), class: "btn btn-clear-filters" %>
          <% end %>
        </div>
      </div>

      <!-- Preserve sort and direction params -->
      <%= hidden_field_tag :sort, params[:sort] %>
      <%= hidden_field_tag :direction, params[:direction] %>
    <% end %>
  </div>

  <table id="resumes" border="1">
  <thead>
    <tr>
      <th>
        User
        <%= link_to "↑", resumes_path(request.query_parameters.merge(sort: 'user', direction: 'asc')), title: 'Sort user asc' %>
        <%= link_to "↓", resumes_path(request.query_parameters.merge(sort: 'user', direction: 'desc')), title: 'Sort user desc' %>
      </th>
      <th>
        GPA
        <%= link_to "↑", resumes_path(request.query_parameters.merge(sort: 'gpa', direction: 'asc')), title: 'Sort gpa asc' %>
        <%= link_to "↓", resumes_path(request.query_parameters.merge(sort: 'gpa', direction: 'desc')), title: 'Sort gpa desc' %>
      </th>
      <th>
        Graduation Year
        <%= link_to "↑", resumes_path(request.query_parameters.merge(sort: 'graduation_date', direction: 'asc')), title: 'Sort graduation_date asc' %>
        <%= link_to "↓", resumes_path(request.query_parameters.merge(sort: 'graduation_date', direction: 'desc')), title: 'Sort graduation_date desc' %>
      </th>
      <th>
        Major
        <%= link_to "↑", resumes_path(request.query_parameters.merge(sort: 'major', direction: 'asc')), title: 'Sort major asc' %>
        <%= link_to "↓", resumes_path(request.query_parameters.merge(sort: 'major', direction: 'desc')), title: 'Sort major desc' %>
      </th>
      <th>
        Organizational Role
        <%= link_to "↑", resumes_path(request.query_parameters.merge(sort: 'organizational_role', direction: 'asc')), title: 'Sort organizational_role asc' %>
        <%= link_to "↓", resumes_path(request.query_parameters.merge(sort: 'organizational_role', direction: 'desc')), title: 'Sort organizational_role desc' %>
      </th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @resumes.each do |resume| %>
      <tr>
        <td><%= resume.user.email %></td>
        <td><%= resume.gpa %></td>
        <td><%= resume.graduation_date %></td>
        <td><%= resume.major %></td>
        <td>
          <% if resume.organizational_roles.any? %>
            <%= resume.organizational_roles.map(&:name).join(", ") %>
          <% else %>
            <em>None</em>
          <% end %>
        </td>
        <td><%= link_to "Show", resume_path(resume) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= paginate @resumes, params: request.query_parameters.except(:page) %>
</div>

