<% content_for :title, "Homepage" %>

<div class="homepage-simple">
  <h1>Homepage</h1>
  <% if admin_signed_in? %>
    <p>You are signed in as <strong><%= current_admin.full_name || current_admin.email %></strong>.</p>
  <% else %>
    <p>You are not signed in.</p>
  <% end %>
  <div class="actions">
    <%= link_to "Sign Out", destroy_admin_session_path, class: "btn" %>
    <% if admin_signed_in? %>
      <% current_user = User.find_by(google_uid: current_admin.uid) %>
      <% if current_user %>
        <%= link_to "View My Profile", user_path(current_user), class: "btn" %>
      <% end %>
    <% end %>
    <%= link_to "Users", users_path, class: "btn" %>
    <% if admin_user? %>
      <%= link_to "Admin Dashboard", admin_panel_root_path, class: "btn" %>
    <% end %>
    
    <%# Resume-related links based on user role %>
    <% if admin_signed_in? %>
      <% current_user = User.find_by(google_uid: current_admin.uid) %>
      <% if current_user %>
        <%# Admins and sponsors can view all resumes %>
        <% if current_user.role&.in?(['admin', 'sponsor']) %>
          <%= link_to "Browse Resumes", resumes_path, class: "btn btn-resume-index" %>
        <% end %>
        
        <%# All users (including admins) can view their own resume if they have one %>
        <% if current_user.resume.present? %>
          <%= link_to "My Resume", resume_path(current_user.resume), class: "btn btn-my-resume" %>
        <% else %>
          <%= link_to "Upload Resume", new_user_resume_path(current_user), class: "btn btn-my-resume" %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<div class="events-section">
  <div class="events-container">
    <h2 class="events-title">Upcoming Events</h2>
    <% if @upcoming_events.present? %>
      <ul class="events-list">
        <% @upcoming_events.each do |event| %>
          <li class="event-item">
            <div class="event-main">
              <span class="event-title"><%= link_to event.title, event_path(event) %></span>
              <span class="event-date"><%= event.formatted_date %></span>
            </div>
            <div class="event-meta">
              <span class="event-location"><%= event.location %></span>
              <% if event.capacity.present? %>
                <span class="event-capacity">Capacity: <%= event.capacity %></span>
              <% end %>
            </div>
            <div class="event-actions">
              <%= link_to "View & RSVP", event_path(event), class: "btn" %>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="events-empty">No upcoming events scheduled.</p>
    <% end %>
  </div>
  <% if admin_signed_in? %>
    <div class="events-actions">
      <%= link_to "Manage Events", admin_panel_events_path, class: "btn" %>
    </div>
  <% end %>
</div>