<% content_for :title, "Role Applications" %>

<div class="role-applications-admin-index">
  <div class="navigation-buttons">
    <%= link_to root_path, class: "back-to-home" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>Home</span>
    <% end %>
    <%= link_to admin_panel_root_path, class: "back-to-dashboard" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      <span>Back to Dashboard</span>
    <% end %>
  </div>

  <h1>Role Applications</h1>
  <p class="subtitle">Review and manage all submitted applications.</p>

  <!-- Status Filters -->
  <%= form_with url: admin_panel_role_applications_path, method: :get, local: true do |form| %>
    <div class="filter-section">
      <h3>Filter by Status</h3>
      <div class="filter-checkboxes">
        <label>
          <%= check_box_tag 'status[not_reviewed]', '1', params.dig(:status, :not_reviewed) == '1' %>
          <span class="status-label not-reviewed">● Not Reviewed</span>
        </label>
        <label>
          <%= check_box_tag 'status[in_review]', '1', params.dig(:status, :in_review) == '1' %>
          <span class="status-label in-review">● In Review</span>
        </label>
        <label>
          <%= check_box_tag 'status[accepted]', '1', params.dig(:status, :accepted) == '1' %>
          <span class="status-label accepted">● Accepted</span>
        </label>
        <label>
          <%= check_box_tag 'status[rejected]', '1', params.dig(:status, :rejected) == '1' %>
          <span class="status-label rejected">● Rejected</span>
        </label>
      </div>
      <div class="filter-actions">
        <%= form.submit "Apply Filters", class: "btn-apply-filters" %>
        <%= link_to "Clear Filters", admin_panel_role_applications_path, class: "btn-clear-filters" %>
      </div>
    </div>
  <% end %>

  <% if @role_applications.any? %>
    <div class="applications-grid">
      <% @role_applications.each do |application| %>
        <div id="role_application_<%= application.id %>" class="application-card">
          <div class="card-header">
            <div class="applicant-info">
              <h3><%= application.user.first_name %> <%= application.user.last_name %></h3>
              <p class="email"><%= application.user.email %></p>
            </div>
            <span class="role-badge">
              <%= application.organizational_role.name %>
            </span>
          </div>

          <div class="card-field">
            <strong>Submitted:</strong> <%= application.created_at.strftime("%B %d, %Y at %I:%M %p") %>
          </div>

          <div class="card-field">
            <strong>Status:</strong>
            <span class="status-controls">
              <%= form_with model: application, url: update_status_admin_panel_role_application_path(application), method: :patch do |f| %>
                <%= f.select :status, 
                    RoleApplication.statuses.keys.map { |s| [s.titleize, s] }, 
                    { selected: application.status },
                    { 
                      onchange: "this.form.requestSubmit()",
                      class: "status-dropdown"
                    } %>
              <% end %>
              <%= status_badge(application.status) %>
            </span>
          </div>

          <div class="card-field">
            <strong>Resume:</strong>
            <% if application.user.resume&.file&.attached? %>
              <%= link_to application.user.resume.file.filename, user_resume_path(application.user), target: "_blank", class: "resume-link" %>
            <% else %>
              <span class="no-resume">No resume</span>
            <% end %>
          </div>

          <div class="card-field">
            <strong>Essay:</strong>
            <div class="essay-preview">
              <%= simple_format(application.essay) %>
            </div>
          </div>

          <div class="card-actions">
            <%= link_to "View Full Application", admin_panel_role_application_path(application), class: "btn-view" %>
            <%= button_to "Delete", admin_panel_role_application_path(application), 
                method: :delete,
                data: { turbo_confirm: "Are you sure you want to delete this application?" },
                class: "btn-delete" %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="no-applications">
      No applications have been submitted yet.
    </div>
  <% end %>
</div>
