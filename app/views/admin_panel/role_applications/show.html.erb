<% content_for :title, "Application Details" %>

<div style="padding: 20px; max-width: 900px; margin: 0 auto;">
  <h1>Application Details</h1>

  <div style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 30px; margin-top: 20px;">
    <div style="margin-bottom: 25px;">
      <h2 style="margin: 0 0 10px 0;"><%= @role_application.user.first_name %> <%= @role_application.user.last_name %></h2>
      <p style="color: #6c757d; margin: 0;"><%= @role_application.user.email %></p>
    </div>

    <div style="margin-bottom: 20px;">
      <strong>Applied For:</strong>
      <span style="background-color: #007bff; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-left: 10px;">
        <%= @role_application.organizational_role.name %>
      </span>
    </div>

    <div style="margin-bottom: 20px;">
      <strong>Status:</strong>
      <%= status_badge(@role_application.status) %>
    </div>

    <div style="margin-bottom: 20px;">
      <strong>Submitted:</strong> <%= @role_application.created_at.strftime("%B %d, %Y at %I:%M %p") %>
    </div>

    <div style="margin-bottom: 20px;">
      <strong>Last Updated:</strong> <%= @role_application.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
    </div>

    <div style="margin-bottom: 20px;">
      <strong>Resume:</strong>
      <% if @role_application.user.resume&.file&.attached? %>
        <%= link_to @role_application.user.resume.file.filename, user_resume_path(@role_application.user), 
            target: "_blank", 
            style: "color: #007bff; margin-left: 10px;" %>
        <br>
        <small style="color: #6c757d;">
          GPA: <%= @role_application.user.resume.gpa || 'N/A' %> | 
          Major: <%= @role_application.user.resume.major || 'N/A' %> | 
          Graduation: <%= @role_application.user.resume.graduation_date || 'N/A' %>
        </small>
      <% else %>
        <span style="color: #dc3545;">No resume attached</span>
      <% end %>
    </div>

    <div style="margin-bottom: 20px;">
      <strong>Application Responses:</strong>
      
      <% if @role_application.organizational_role.question_1.present? && @role_application.answer_1.present? %>
        <div style="margin-top: 15px;">
          <strong style="color: #495057;"><%= @role_application.organizational_role.question_1 %></strong>
          <div style="background-color: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; margin-top: 5px; white-space: pre-wrap;">
            <%= @role_application.answer_1 %>
          </div>
        </div>
      <% end %>

      <% if @role_application.organizational_role.question_2.present? && @role_application.answer_2.present? %>
        <div style="margin-top: 15px;">
          <strong style="color: #495057;"><%= @role_application.organizational_role.question_2 %></strong>
          <div style="background-color: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; margin-top: 5px; white-space: pre-wrap;">
            <%= @role_application.answer_2 %>
          </div>
        </div>
      <% end %>

      <% if @role_application.organizational_role.question_3.present? && @role_application.answer_3.present? %>
        <div style="margin-top: 15px;">
          <strong style="color: #495057;"><%= @role_application.organizational_role.question_3 %></strong>
          <div style="background-color: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; margin-top: 5px; white-space: pre-wrap;">
            <%= @role_application.answer_3 %>
          </div>
        </div>
      <% end %>

      <% if @role_application.organizational_role.question_1.blank? && 
            @role_application.organizational_role.question_2.blank? && 
            @role_application.organizational_role.question_3.blank? %>
        <p style="color: #6c757d; font-style: italic; margin-top: 10px;">This role had no application questions.</p>
      <% end %>
    </div>
  </div>

  <!-- Update Status Section -->
  <div style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-top: 30px;">
    <h2 style="margin-bottom: 15px; font-size: 1.25rem;">Update Application Status</h2>
    <%= form_with model: @role_application, url: update_status_admin_panel_role_application_path(@role_application), method: :patch, local: true do |form| %>
      <div style="margin-bottom: 15px;">
        <%= form.label :status, "Status:", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
        <%= form.select :status, 
            options_for_select(
              [
                ['Not Reviewed', 'not_reviewed'],
                ['In Review', 'in_review'],
                ['Interview Needed', 'interview_needed'],
                ['Accepted', 'accepted'],
                ['Rejected', 'rejected']
              ],
              @role_application.status
            ),
            {},
            style: "padding: 8px; border: 1px solid #ced4da; border-radius: 4px; width: 100%; max-width: 300px;" %>
      </div>
      <%= form.submit "Update Status", style: "padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;" %>
    <% end %>
  </div>

  <div class="show-page-actions">
    <%= button_to "â† Back to Applications", admin_panel_role_applications_path,
        method: :get,
        class: "btn btn-outline",
        form: { style: 'display: inline;' } %>
    <%= button_to "Delete Application", admin_panel_role_application_path(@role_application),
        method: :delete,
        class: "btn btn-danger",
        form: { style: 'display: inline;', data: { turbo_confirm: "Are you sure you want to delete this application?" } } %>
  </div>
</div>
