<div class="admin-assign-users-page">
  <div class="page-header">
    <h1>Assign Users to <%= @sponsor.company_name %></h1>
    <div class="header-info">
      Currently assigned: <strong><%= @sponsor.users.count %></strong> user(s)
    </div>
  </div>

  <div class="assign-form-card">
    <%= form_with model: @sponsor, url: update_users_admin_panel_sponsor_path(@sponsor), method: :patch, local: true, class: 'assign-users-form' do |f| %>
      <div class="form-section">
        <h3>Select Users</h3>
        <p class="form-help-text">Only users with 'sponsor' role can be assigned to sponsors.</p>

        <% if @available_users.any? %>
          <div class="users-checkboxes">
            <%= f.collection_check_boxes :user_ids, @available_users, :id, :email, checked: @sponsor.user_ids do |b| %>
              <div class="checkbox-item">
                <%= b.check_box class: "form-checkbox" %>
                <%= b.label class: "checkbox-label" do %>
                  <span class="user-email"><%= b.object.email %></span>
                  <% if b.object.first_name.present? %>
                    <span class="user-name">(<%= b.object.first_name %> <%= b.object.last_name %>)</span>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="empty-state">
            <p>No users with 'sponsor' role found. Please create sponsor users first.</p>
          </div>
        <% end %>
      </div>

      <div class="form-actions">
        <%= f.submit "Update Users", class: "btn btn-primary" %>
        <%= button_to "Cancel", admin_panel_sponsor_path(@sponsor), method: :get, class: "btn btn-outline", form: { style: 'display: inline;' } %>
      </div>
    <% end %>
  </div>

  <div class="assigned-users-card">
    <h3>Currently Assigned Users</h3>
    <% if @sponsor.users.any? %>
      <ul class="assigned-users-list">
        <% @sponsor.users.each do |user| %>
          <li class="assigned-user-item">
            <span class="user-email"><%= user.email %></span>
            <% if user.first_name.present? %>
              <span class="user-name">(<%= user.first_name %> <%= user.last_name %>)</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <div class="empty-state">
        <p>No users currently assigned to this sponsor.</p>
      </div>
    <% end %>
  </div>
</div>